<div class="content-header">
  <div class="container-fluid">
    <div class="row mt-5 justify-content-center text-center">
      <div class="col-sm-9 cabecera sombra border">
        <h5 class="mt-2 font-weight-bold">Nuevo Móvimiento</h5>
      </div>
    </div>
  </div>
</div>
<div class="content">
  <div class="container-fluid">
    <div class="row justify-content-center">
      <div class="card card-body col-sm-9 detalle sombra">
        <form [formGroup]="formMovimiento">
          <div class="row roboto">
            <!-- NUMERO -->
            <div class="form-group col-ml-3">
              <div class="input-group input-group-sm">
                <div class="input-group-prepend">
                  <label for="" class="input-group-text">Número<sup class="green">*</sup></label>
                </div>
                <input #inputPrimero type="text" class="form-control text-center" formControlName="numero"
                  (change)="numAvailable($event)" aria-label="Small" aria-describedby="inputGroup-sizing-sm"
                  maxlength="10" [ngClass]="{'is-invalid': f['numero'].invalid && f['numero'].touched,
                           'is-valid': f['numero'].valid, '': f['numero'].untouched}">
              </div>
              <div *ngIf="authService.msgval && f['numero'].errors && f['numero'].touched">
                <div *ngIf="f['numero'].errors['required']"
                  class="alert alert-warning m-0 py-0 px-1 pr-0 robotosmall border" role="alert">
                  <strong>Ups!</strong> El número es obligatorio
                </div>
                <div *ngIf="f['numero'].errors['min']" class="alert alert-warning m-0 py-0 px-1 pr-0 robotosmall border"
                  role="alert">
                  <strong>Ups!</strong> El número debe ser mayor a cero.
                </div>

                <div *ngIf="f['numero'].errors['notAvailable']"
                  class="alert alert-warning m-0 py-0 px-1 pr-0 robotosmall border" role="alert">
                  <strong>Ups!</strong> Ese código ya existe
                </div>
              </div>
            </div>
            <!-- FECHA -->
            <div class="form-group col-md-4">
              <div class="input-group input-group-sm">
                <div class="input-group-prepend">
                  <label class="input-group-text">Fecha<sup class="green">*</sup></label>
                </div>
                <input type="date" class="form-control" formControlName="fecha" aria-label="Small"
                  aria-describedby="inputGroup-sizing-sm" [ngClass]="{'is-invalid': f['fecha'].invalid && f['fecha'].touched,
                             'is-valid': f['fecha'].valid, '': f['fecha'].untouched}">
              </div>
            </div>
            <!-- NUM ENTRADA -->
            <div class="form-group col-ml-3">
              <div class="input-group input-group-sm">
                <div class="input-group-prepend">
                  <label for="" class="input-group-text">Num. Entrada<sup class="green">*</sup></label>
                </div>
                <input #inputPrimero type="text" class="form-control text-center" formControlName="numentrada"
                  aria-label="Small" aria-describedby="inputGroup-sizing-sm" [ngClass]="{'is-invalid': f['numentrada'].invalid && f['numentrada'].touched,
                           'is-valid': f['numentrada'].valid, '': f['numentrada'].untouched}">
              </div>
              <div *ngIf="authService.msgval && f['numentrada'].errors && f['numentrada'].touched">
                <div *ngIf="f['numentrada'].errors['required']"
                  class="alert alert-warning m-0 py-0 px-1 pr-0 robotosmall border" role="alert">
                  <strong>Ups!</strong> El número es obligatorio
                </div>
                <div *ngIf="f['numentrada'].errors['min']"
                  class="alert alert-warning m-0 py-0 px-1 pr-0 robotosmall border" role="alert">
                  <strong>Ups!</strong> El número debe ser mayor a cero.
                </div>

              </div>
            </div>
            <!-- APROBADO -->
            <div class="form-group col-ml-2 ml-2">
              <div class="input-group input-group-sm">
                <div class="input-group-prepend">
                  <label for="" class="input-group-text">Aprobado</label>
                </div>
                <input #inputPrimero type="checkbox" class="form-control text-center" formControlName="swaprobado"
                  aria-label="Small" aria-describedby="inputGroup-sizing-sm">
              </div>
            </div>
            <!-- DOCUMENTOS -->
            <div class="form-group col-md-12">
              <div class="input-group input-group-sm">
                <div class="input-group-prepend">
                  <label class="input-group-text">Documento<sup class="green">*</sup></label>
                </div>

                <select formControlName="documento" class="form-control col-sm-2 form-control-sm">
                  <option *ngFor="let doc of _documentos" [ngValue]=doc>
                    {{doc.nomdoc}}</option>
                </select>
                <input type="text" class="form-control form-control-sm bg-light" formControlName="numdoc" placeholder="DOC-123" tabindex="-1"
                  [ngClass]="{'is-invalid': f['numdoc'].invalid && f['numdoc'].touched,
                             'is-valid': f['numdoc'].valid, '': f['numdoc'].untouched}">
                <input type="date" class="form-control form-control-sm bg-light" formControlName="fecdoc" tabindex="-1"
                  [ngClass]="{'is-invalid': f['fecdoc'].invalid && f['fecdoc'].touched,
                             'is-valid': f['fecdoc'].valid, '': f['fecdoc'].untouched}">
              </div>
              <div *ngIf="authService.msgval && f['numdoc'].errors && f['numdoc'].touched">
                <div *ngIf="f['numdoc'].errors['required']"
                  class="alert alert-warning m-0 py-0 px-1 pr-0 robotosmall border" role="alert">
                  <strong>Ups!</strong> El número de documento es obligatorio
                </div>
                <div *ngIf="f['numdoc'].errors['minLength']"
                  class="alert alert-warning m-0 py-0 px-1 pr-0 robotosmall border" role="alert">
                  <strong>Ups!</strong> Longitud inválida
                </div>
              </div>
            </div>
            <!-- BENEFICIARIO -->
            <div class="form-group col-md-4">
              <div class="input-group input-group-sm">
                <div class="input-group-prepend">
                  <label class="input-group-text">Beneficiario<sup class="green">*</sup></label>
                </div>

                <input type="text" class="form-control form-control-sm col-md" autocomplete="off" autocorrect="off"
                  autocapitalize="off" spellcheck="false" formControlName="beneficiarioText"
                  placeholder="Nombre del beneficiario" list="beneficiarioList" (input)="onBeneficiarioTyped($event)"
                  (blur)="onBeneficiarioSelected($event)" [ngClass]="{'is-invalid': f['beneficiarioText'].invalid && f['beneficiarioText'].touched,
                             'is-valid': f['beneficiarioText'].valid, '': f['beneficiarioText'].untouched}">

                <datalist role="listbox" id="beneficiarioList">
                  <!-- Puedes usar sólo el nombre, o combinar id | nombre para asegurar unicidad -->
                  <option *ngFor="let bene of _beneficiarios" [value]="bene.nomben">
                    {{ bene.codben }}
                  </option>
                </datalist>
              </div>
              <div *ngIf="authService.msgval && f['beneficiarioText'].errors && f['beneficiarioText'].touched">
                <div *ngIf="f['beneficiarioText'].errors['required']"
                  class="alert alert-warning m-0 py-0 px-1 pr-0 robotosmall border" role="alert">
                  <strong>Ups!</strong> El beneficiario es obligatorio
                </div>
              </div>
            </div>
            <!-- DESTINO -->
            <div class="form-group col-md-4">
              <div class="input-group input-group-sm">
                <div class="input-group-prepend">
                  <label class="input-group-text">Destino<sup class="green">*</sup></label>
                </div>

                <input list="destinoList" class="form-control form-control-sm col-md" autocomplete="off"
                  autocorrect="off" autocapitalize="off" spellcheck="false" formControlName="destinoText"
                  placeholder="Ingrese el destino" (input)="onDestinoTyped($event)" (blur)="onDestinoSelected($event)"
                  [ngClass]="{'is-invalid': f['destinoText'].invalid && f['destinoText'].touched,
                             'is-valid': f['destinoText'].valid, '': f['destinoText'].untouched}">

                <datalist role="listbox" id="destinoList">
                  <option *ngFor="let dest of _destinos" [value]="dest.nomdestino">
                    {{ dest.nomdestino }}
                  </option>
                </datalist>
              </div>
              <div *ngIf="authService.msgval && f['destinoText'].errors && f['destinoText'].touched">
                <div *ngIf="f['destinoText'].errors['required']"
                  class="alert alert-warning m-0 py-0 px-1 pr-0 robotosmall border" role="alert">
                  <strong>Ups!</strong> El destino es obligatorio
                </div>
              </div>
            </div>
            <!-- COM PEGRE -->
            <div class="form-group col-ml-3">
              <div class="input-group input-group-sm">
                <div class="input-group-prepend">
                  <label for="" class="input-group-text">Com pegre<sup class="green">*</sup></label>
                </div>
                <input #inputPrimero type="text" class="form-control text-center" formControlName="compegre"
                  aria-label="Small" aria-describedby="inputGroup-sizing-sm" maxlength="10" [ngClass]="{'is-invalid': f['compegre'].invalid && f['compegre'].touched,
                           'is-valid': f['compegre'].valid, '': f['compegre'].untouched}">
              </div>
              <div *ngIf="authService.msgval && f['compegre'].errors && f['compegre'].touched">
                <div *ngIf="f['compegre'].errors['required']"
                  class="alert alert-warning m-0 py-0 px-1 pr-0 robotosmall border" role="alert">
                  <strong>Ups!</strong> El número es obligatorio
                </div>
                <div *ngIf="f['compegre'].errors['min']"
                  class="alert alert-warning m-0 py-0 px-1 pr-0 robotosmall border" role="alert">
                  <strong>Ups!</strong> El número debe ser mayor a cero.
                </div>

                <div *ngIf="f['compegre'].errors['notAvailable']"
                  class="alert alert-warning m-0 py-0 px-1 pr-0 robotosmall border" role="alert">
                  <strong>Ups!</strong> Ese código ya existe
                </div>
              </div>
            </div>
            <!-- OBSERVACIONES -->
            <div class="form-group col-sm-12">
              <div class="input-group input-group-sm">
                <div class="input-group-prepend">
                  <label for="observaciones" class="input-group-text">Observaciones</label>
                </div>
                <textarea #inputPrimero type="text" id="observaciones" class="form-control"
                  formControlName="observaciones" aria-label="Small"></textarea>
              </div>

            </div>
          </div>
        </form>
        <div class="row">
          <div *ngIf="formMovimiento" class="col-md-12 text-center">
            <button type="button" class="btn btn-success btn-sm mx-1" (click)="guardar()"
              [disabled]="formMovimiento.invalid ">
              <i class="fa fa-check-circle"></i>&nbsp; Aceptar</button>
            <button class="btn btn-outline-success btn-sm mx-1" (click)="regresar()"><i class="fa fa-times-circle"></i>
              Cancelar</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
